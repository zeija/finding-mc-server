@echo off
title Advanced Minecraft Scanner v2.0 - by v1rox
color 0a
cls

:: Check for Node.js installation
echo ğŸ” Checking system requirements...
node --version >nul 2>&1
if %errorlevel% neq 0 (
    color 0c
    echo âŒ ERROR: Node.js is not installed or not in PATH
    echo.
    echo ğŸ“¥ Please install Node.js 18+ from: https://nodejs.org
    echo ğŸ’¡ Make sure to check "Add to PATH" during installation
    echo.
    pause
    exit /b 1
)

:: Display Node.js version
echo âœ… Node.js version: 
node --version

:: Check if npm packages are installed
echo ğŸ” Checking dependencies...
if not exist "node_modules\" (
    echo ğŸ“¦ Installing dependencies...
    npm install
    if %errorlevel% neq 0 (
        color 0c
        echo âŒ Failed to install dependencies
        pause
        exit /b 1
    )
    echo âœ… Dependencies installed successfully
)

:: Create logs directory if it doesn't exist
if not exist "%USERPROFILE%\.minecraft-scanner\logs\" (
    mkdir "%USERPROFILE%\.minecraft-scanner\logs\" 2>nul
)

:: Display banner
echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                                      â•‘
echo â•‘  ğŸ® Advanced Minecraft Server Scanner v2.0                          â•‘
echo â•‘                                                                      â•‘
echo â•‘  ğŸš€ Starting enhanced scanning with auto-restart...                 â•‘
echo â•‘  ğŸ’¡ Created by v1rox ^(Discord: v1rox^)                               â•‘
echo â•‘                                                                      â•‘
echo â•‘  âŒ¨ï¸  Controls:                                                        â•‘
echo â•‘  â€¢ Press [P] to pause/resume                                        â•‘
echo â•‘  â€¢ Press [S] to save progress                                        â•‘
echo â•‘  â€¢ Press [R] to reset statistics                                     â•‘
echo â•‘  â€¢ Press [Q] or Ctrl+C to quit                                       â•‘
echo â•‘                                                                      â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: Set performance flags for better performance
set NODE_OPTIONS=--max-old-space-size=4096 --gc-interval=100

:: Main restart loop
:restart
echo ğŸš€ [%date% %time%] Starting Minecraft Scanner...
echo.

:: Run the scanner with enhanced error handling
node scanmc.js
set SCANNER_EXIT_CODE=%errorlevel%

:: Handle different exit codes
if %SCANNER_EXIT_CODE% equ 0 (
    echo.
    echo âœ… Scanner stopped gracefully
    echo ğŸ’¾ All data has been saved
    goto :end
)

if %SCANNER_EXIT_CODE% equ 1 (
    color 0e
    echo.
    echo âš ï¸  Scanner encountered an error, restarting in 5 seconds...
    echo ğŸ”„ This helps maintain continuous operation
    timeout /t 5 /nobreak >nul
    color 0a
    goto restart
)

if %SCANNER_EXIT_CODE% equ 2 (
    color 0c
    echo.
    echo âŒ Critical error detected - manual intervention required
    echo ğŸ“ Check the logs in: %USERPROFILE%\.minecraft-scanner\logs\
    pause
    goto :end
)

:: Unknown exit code
color 0e
echo.
echo âš ï¸  Unexpected exit code: %SCANNER_EXIT_CODE%
echo ğŸ”„ Attempting restart in 3 seconds...
timeout /t 3 /nobreak >nul
color 0a
goto restart

:end
echo.
echo ğŸ‘‹ Thanks for using Advanced Minecraft Scanner!
echo ğŸ“Š Check your results in: discovered-servers.txt
echo ğŸ“ Detailed logs: %USERPROFILE%\.minecraft-scanner\
echo.
echo ğŸŒŸ If you found this useful, please star the repo!
echo ğŸ”— GitHub: https://github.com/zeija/Finding-MC-Server
echo.
pause